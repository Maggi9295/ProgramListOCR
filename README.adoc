= Program List OCR マニュアル
eighttails <http://eighttails.seesaa.net>
:toc-title: 目次
:toc:
:numbered:
:data-uri:

by eighttails +
http://eighttails.seesaa.net

== はじめに
本ソフトは、主に1980年代のパソコン雑誌に掲載されたプログラムリストの読み取りに特化したOCRです。 +
紙面をスキャナで取り込み、OCRでテキストファイルにしたものをエミュレーター用のテープイメージ等に変換するという使い方を想定しています。 +
本ソフトは、以下のオープンソースソフトウェアの組み合わせです。

* Tesseract(OCRエンジン)
* gImageReader(GUIフロントエンド)

上記に加えて、独自にOCRに学習させて作成した以下の言語ファイルを含んでいます。

* BASIC(PC-6001シリーズ用N6X-Basic)
* 16進ダンプリスト

BASIC言語に関しては、フォントや単語、かなやグラフィック文字の仕様などPC-6001に合わせて言語ファイルを作ってありますので、他機種のプログラムをそのまま読み込むのは難しいと思われますが、MS系のBASICで英数字のみに割り切ればもしかしたら読めるかもしれません。 +
ダンプリストの方はBASICよりは汎用的に使えると思います。こちらは読み取り精度向上のため、16進数+α(0-9,A-F,Sum)以外の文字は使われていないという前提で読み込むようになっています。


== 使用方法
=== インストール方法
ProgramListOCR.exeをダブルクリックしてインストールします。 +
インストーラーの指示に従って操作すれば完了です。

=== 起動方法
スタートメニューから「Program List OCR」->「gImageReader」を選択するとOCRのGUIが起動します。

image::images/Image-120218-055039.703.png[]

=== 操作手順
==== 画像スキャン、前処理

読み込む対象のプログラムが掲載された紙面をスキャンします。 +
スキャン後はテキストの傾き、ゆがみがなるべく無い様に補正してください。 +
画像の補正方法について、私のやり方をブログで公開していますので、よろしければ参考にしてください。 +
http://eighttails.seesaa.net/article/283953696.html 

推奨する形式は、600DPI、グレースケール、TIFFまたは高画質設定のJPEGです。 +
文字が薄い場合、GIMPを使って補正すると読み取り精度が上がります。 +
GIMPのメニューから「フィルター」->「汎用」->「明るさの最大値」を実行するとかすれた文字を補正することができます。

.「明るさの最大値」適用前
image::images/BEFORE.PNG[]
.「明るさの最大値」適用後
image::images/AFTER.PNG[]

その後、GIMPのメニューから「色」->「しきい値」を用いて画像を2値化しておくことをお勧めします。

==== 画像読み込み
画像を読み込むには、画面左ペインのフォルダボタンをクリックします。

image::images/OPEN.PNG[]

ファイル選択ダイアログが開くので、読み込む対象の画像ファイルを選択します。 +
複数枚の画像を同時に選択することも可能です。

==== 読み取り範囲指定、実行
[WARNING]
====
このステップの操作は#1ページずつ#行ってください。 +
読み取りを実行する前にページを移動すると選択範囲がクリアされてしまいます。
====
プログラムリストとして読み取る範囲をドラッグして指定します。 +
多段組になっていて読み取り範囲が複数ある場合はCTRL+ドラッグで選択範囲を追加できます。

image::images/Image-130218-034520.789.png[]

選択が終わったら、ツールバー上の「Recocnize Selection」ボタンをクリックして読み取りを実行します。 +
「Recocnize Selection」ボタンはプルダウンになっており、BASICプログラムを読み取る際は「tessdata/n6x」、マシン後を読み取る際は「tessdata/hex」を選択した状態で実行してください。

読み取りにはかなりの時間がかかります。気長に待ってください。

==== テキスト整形
読み取りが完了すると、右のペインに認識結果が現れます。

image::images/Image-130218-043350.929.png[]
このテキストをお好みのテキストエディタにコピー、ペーストしてください。

この状態のテキストは行のつながりを認識できていません。印刷の都合で2行に折り返されてしまった行は分割して出力されているので、目視で連結してやる必要があります。 +


==== 後処理
整形が終わったテキストファイルは、エミュレータ用のテープイメージ変換ツールなどに渡してご利用ください。

PC-6001用BASICの場合は、拙作の http://eighttails.seesaa.net/article/305067428.html[N6XBasicChecker] を使えばシンタックスエラーレベルの認識ミスはイメージ変換、実行前に発見することができます。

== 使用フォント
今回のOCRは、Googleより配布されている英語用の言語データをベースに以下のフォントを使ってファインチューニングを行っています。 +
ビットマップフォント、ドットマトリクス印字によるフォントに対応するためプログラムリストによく使われるフォントを追加していますが、Googleの学習済みモデルをベースにしているので、たいていの書体は読めると思います。 +
フォント自体の再配布を行うことはできないので、学習用スクリプト内でダウンロードして使用するようになっています。 +

.DotMatrix
https://www.ffonts.net/DotMatrix-Regular.font

.P6TrueTypeフォント
Hashi様作 +
http://p6ers.net/hashi/p6ttf.html

.VLゴシック
鈴木大輔様作 +
http://vlgothic.dicey.org/

.Takaoフォント
https://launchpad.net/takao-fonts

.PixelMPlus
itouhiro様作 +
http://itouhiro.hatenablog.com/entry/20130602/font

.MSX風Truetypeフォント
Gigamix様作 +
http://www.gigamix.jp/download/gigamix/msxfont.php

.P6プリンタルーチンフォント
Mr.PCばんざーい!!様作 +
電波新聞社刊「PC-6001・6601プログラム大全集」掲載プログラム内のフォントをeighttailsがTrueType化

== 開発者情報
=== ライセンス
配布しているバイナリのライセンスは以下の通りとなります。

Tesseract:: 
* Apache License 2.0
* https://github.com/tesseract-ocr/tesseract
gImageReader:: 
* GNU General Public License v3.0
* https://github.com/manisandro/gImageReader

本リポジトリに含まれるスクリプトはTesseractに含まれているものを改変したものですので、Apache License 2.0とします。


=== ビルド方法
#以下、執筆予定#

=== 学習方法

== 更新履歴
.1.0　2018/02/12
* 初版 +
